{{- $envFile := .Files.Get "secrets/.env" }}
{{- if $envFile }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "myapp.fullname" . }}-secrets
  labels:
    {{- include "myapp.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- range $line := (splitList "\n" $envFile) }}
  {{- $trimmed := trim $line }}
  {{- if and $trimmed (not (hasPrefix "#" $trimmed)) }}
  {{- $parts := splitn "=" 2 $trimmed }}
  {{- if eq (len $parts) 2 }}
  {{- $key := trim (index $parts 0) }}
  {{- $value := trim (index $parts 1) }}
  {{ $key }}: {{ $value | quote }}
  {{- end }}
  {{- end }}
  {{- end }}
{{- end }}

{{- if .Files.Get "secrets/tls-cert.pem" }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "myapp.fullname" . }}-tls
  labels:
    {{- include "myapp.labels" . | nindent 4 }}
type: kubernetes.io/tls
data:
  tls.crt: {{ .Files.Get "secrets/tls-cert.pem" | b64enc }}
  tls.key: {{ .Files.Get "secrets/tls-key.pem" | b64enc }}
{{- end }}
